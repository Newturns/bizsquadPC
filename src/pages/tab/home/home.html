
<ion-content no-padding class="content-color">
  <ion-item no-lines style="border: 1px solid #e3e7f2">
    <!-- 프로필 사진이 있으면 -->
    <ion-avatar item-start *ngIf="currentUser && currentUser.photoURL">
      <img class="photoURL" src="{{currentUser.photoURL}}">
      <div class="statusBadge" (click)="showStatus()" [style.background-color]="myStatus">V</div>
    </ion-avatar>
    <!-- 프로필 사진이 없으면 -->
    <ion-avatar class="notPhoto" [style.background-color]=group.data.team_color item-start *ngIf="currentUser && currentUser.photoURL == null && displayName != null">
      <span class="displayName">{{ displayName }}</span>
      <div class="statusBadge" (click)="showStatus()" [style.background-color]="myStatus">V</div>
    </ion-avatar>

    <div class="d-flex align-items-center">
      <div class="">
        <span *ngIf="currentUser.displayName != null">{{ fullName }}</span>
        <span *ngIf="currentUser.displayName == null">{{ currentUser.email }}</span>
      </div>

      <div class="badge-btn d-flex flex-grow-1 justify-content-end align-items-center">
        <button end ion-button icon-only clear (click)="tokenService.makeWebJump('property',group.gid)" [hidden]="!manager">
          <ion-icon name="customSetting"></ion-icon>
        </button>
        <button end ion-button icon-only clear class="badge-btn" (click)="showNotify()">
          <ion-icon name="customBell"></ion-icon>
        </button>
        <button end ion-button icon-only clear (click)="showMenu()" class="p-2">
          <ion-icon name="more" style="color: #707c97"></ion-icon>
        </button>
        <div *ngIf="badgeCount" class="notifiBadge d-flex justify-content-center align-items-center" (click)="showNotify()">
          {{badgeCount}}
        </div>
      </div>
    </div>
  </ion-item>

  <div class="popup" *ngIf="menuShow">
    <ul>
      <li id="profileSetting" (click)="tokenService.makeWebJump('mypage')">{{ langPack['myaccount'] }}</li>
      <li id="signoutBtn" (click)="logout()">{{ langPack['logout'] }}</li>
      <li id="exitBtn" (click)="windowClose()">{{ langPack['shutdown'] }}</li>
    </ul>
  </div>
  <div class="statusMenu popup" *ngIf="statusMenu">
    <ul>
      <ion-badge class="selectBadge" color="secondary"></ion-badge><li (click)="changedStatus('online')">{{ langPack['online'] }}</li>
      <ion-badge class="selectBadge" color="yellow"></ion-badge><li (click)="changedStatus('wait')">{{ langPack['wait'] }}</li>
      <ion-badge class="selectBadge" color="danger"></ion-badge><li (click)="changedStatus('busy')">{{ langPack['busy'] }}</li>
    </ul>
  </div>

  <div class="home-con-frame d-flex flex-column justify-content-between align-content-between">
    <div class="home-con bg-white d-flex flex-column justify-content-center">
      <div class="menu-title pl-4 pb-4 flex-shrink-0">{{ langPack['taskbox'] }}</div>
      <div class="menu-con d-flex flex-column justify-content-center">

        <ion-grid>
          <ion-row class="justify-content-start mx-3">
            <ion-col class="col-3">
              <div class="d-flex flex-column align-items-center" (click)="tokenService.makeWebJump('video_chat',group.gid)">
                <div class="menu-box d-flex align-items-center justify-content-center">
                  <img src="imgs/renewal/Icon_video.svg">
                </div>
                <div class="menu-text mt-2">{{langPack['video_chat']}}</div>
              </div>
            </ion-col>
            <ion-col class="col-3">
              <div class="d-flex flex-column align-items-center" (click)="tokenService.makeWebJump('SFA',group.gid)">
                <div class="menu-box d-flex align-items-center justify-content-center">
                  <img src="imgs/renewal/Icon_sales.svg">
                </div>
                <div class="menu-text mt-2">{{ langPack['SFA'] }}</div>
              </div>
            </ion-col>
            <ion-col class="col-3">
              <div class="d-flex flex-column align-items-center" (click)="tokenService.makeWebJump('workflow',group.gid)">
                <div class="menu-box d-flex align-items-center justify-content-center">
                  <img src="imgs/renewal/Icon_workflow.svg">
                </div>
                <div class="menu-text mt-2">{{ langPack['workflow'] }}</div>
              </div>
            </ion-col>
            <ion-col class="col-3">
              <div class="d-flex flex-column align-items-center" (click)="tokenService.makeWebJump('task',group.gid)">
                <div class="menu-box d-flex align-items-center justify-content-center">
                  <img src="imgs/renewal/Icon_task.svg">
                </div>
                <div class="menu-text mt-2">{{ langPack['task'] }}</div>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </div>

    <div class="biz-border-line d-flex flex-grow-1 flex-shrink-1"></div>

    <div class="home-con bg-white d-flex flex-column justify-content-start">
      <!--  more 버튼 클릭시 콘텐츠가 확장되는 스타일   -->
      <div class="d-flex justify-content-between align-items-center px-4 pb-4">
        <div class="menu-title">{{ langPack['apps'] }}</div>
        <div class="pointer" (click)="presentPopover($event)">
          <img src="imgs/renewal/Icon_add.svg">
        </div>
      </div>
      <div class="menu-con">
        <ion-grid #ionGrid class="apps-grid">
          <ion-row class="justify-content-start mx-3">
            <ion-col class="col-3 mb-3" *ngFor="let link of userCustomLinks">
              <div class="d-flex flex-column align-items-center justify-content-center">
                <div class="menu-box d-flex align-items-center justify-content-center" (mouseenter)="link.data.hidden=false" (mouseleave)="link.data.hidden=true">
                  <div class="white-circle d-flex align-items-center justify-content-center">
                    <img class="favicon-img pointer" (click)="goLink($event,link)" *ngIf="link.data.img" src="{{ link.data.img }}">
                    <img class="favicon-img pointer" (click)="goLink($event,link)" *ngIf="!link.data.img" src="{{ getFavicons + link.data.url }}">
                  </div>
                  <ion-icon name="remove-circle" class="link-remove" (click)="removeLink($event,link)" [hidden]="link.data.hidden"></ion-icon>
                </div>
                <div class="menu-text text-55 mt-2 pointer text-center">{{ link.data.title }}</div>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
        <div class="d-flex justify-content-center pointer mt-4" *ngIf="userCustomLinks && userCustomLinks.length > 8" (click)="clickMore()">
          <span class="more-apps-text" *ngIf="!moreAppsMode">{{langPack['more_apps']}}</span>
          <span class="more-apps-text" *ngIf="moreAppsMode">{{langPack['end_more']}}</span>
        </div>
      </div>
    </div>

    <ng-container *ngIf="!moreAppsMode">
      <div class="biz-border-line d-flex flex-grow-1 flex-shrink-1"></div>

      <!-- 최신 공지사항 4개까지 보여줌. -->
      <div class="notice-con bg-white">
        <div class="d-flex flex-column">
          <div class="px-4 py-3 menu-title d-flex justify-content-between align-items-center">
            <div>{{ langPack['BBS'] }}</div>
            <div class="pointer p-1" (click)="tokenService.makeWebJump('bbs')">
              <ion-icon name="ios-arrow-forward" class="font-20 biz-color-default"></ion-icon>
            </div>
          </div>
          <div class="px-4 notice-msg-con d-flex justify-content-between align-items-center pointer" (click)="tokenService.makeWebJump('bbs')"
               *ngFor="let notice of latelyNotice">
            <div class="notice-title d-flex flex-grow-1 flex-shrink-1 align-items-center">
              <span>{{notice.data.title}}</span>
            </div>
            <div class="notice-time d-flex flex-shrink-0 align-items-center">{{notice.data.created | timestampToDate | date:'yyyy-MM-dd hh:mm:ss a'}}</div>
          </div>
        </div>
      </div>
    </ng-container>

    <div class="biz-border-line d-flex flex-grow-1 flex-shrink-1"></div>

    <div class="home-footer bg-white d-flex justify-content-center align-items-center">
      Bizsquad is powered by<span class="link-newturns pointer" (click)="ipc.send('loadGH','https://www.bizsquad.net/')">&nbsp;Newturns&nbsp;</span>Inc.
    </div>
  </div>

</ion-content>
